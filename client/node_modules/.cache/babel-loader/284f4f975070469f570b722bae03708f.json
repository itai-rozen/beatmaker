{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\\\u05D0\\u05D9\\u05EA\\u05D9\\\\Downloads\\\\go local\\\\react\\\\beatmaker\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\\\u05D0\\u05D9\\u05EA\\u05D9\\\\Downloads\\\\go local\\\\react\\\\beatmaker\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\\\u05D0\\u05D9\\u05EA\\u05D9\\\\Downloads\\\\go local\\\\react\\\\beatmaker\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import{Provider}from'./components/Context';import useSound from'use-sound';import notes from'./../src/sounds/all-instruments.mp3';import'./App.css';import Main from'./components/Main/Main.js';function App(){var BEATS=16;var SCALES=['C2','D2','E2','G2','C3','D3','E3','G3','C4','D4','E4'];var getBeatCpts=function getBeatCpts(){var beatCpts=[];for(var i=0;i<BEATS;i++){beatCpts.push(i);}return beatCpts;};var beatCpts=getBeatCpts();var getSoundPoints=function getSoundPoints(){var sounds=[];for(var i=0;i<SCALES.length;i++){sounds.push([]);for(var j=0;j<BEATS;j++){sounds[i].push({i:i,j:j,scale:SCALES[i],activeInstruments:{}});}}return sounds;};var getSprites=function getSprites(){var count=-1000;var sprites={};instruments.forEach(function(instrument){SCALES.forEach(function(scale){sprites[instrument.name+scale]=[count+=1000,1000];});});return sprites;};var _useState=useState(getSoundPoints()),_useState2=_slicedToArray(_useState,2),sounds=_useState2[0],setSounds=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),activeSounds=_useState4[0],setActiveSounds=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),redBeatIndex=_useState6[0],setRedBeatIndex=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),render=_useState8[0],setRender=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),initialState=_useState10[0],setInitialState=_useState10[1];var _useState11=useState([{name:'saxophone',checked:true},{name:'cello',checked:false},{name:'oboe',checked:false},{name:'vocal',checked:false},{name:'guitar',checked:false},{name:'kora',checked:false},{name:'vibraphone',checked:false},{name:'drums',checked:false},{name:'violin',checked:false}]),_useState12=_slicedToArray(_useState11,2),instruments=_useState12[0],setInstruments=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isShowSave=_useState14[0],setIsShowSave=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isShowLoad=_useState16[0],setIsShowLoad=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isPlay=_useState18[0],setIsPlay=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isPause=_useState20[0],setIsPause=_useState20[1];var _useState21=useState(1000),_useState22=_slicedToArray(_useState21,2),delay=_useState22[0],setDelay=_useState22[1];var _useState23=useState(60),_useState24=_slicedToArray(_useState23,2),tempo=_useState24[0],setTempo=_useState24[1];var _useState25=useState(0.75),_useState26=_slicedToArray(_useState25,2),volume=_useState26[0],setVolume=_useState26[1];var _useSound=useSound(notes,{volume:volume,sprite:getSprites(),interrupt:false}),_useSound2=_slicedToArray(_useSound,1),play=_useSound2[0];var playSounds=function playSounds(){if(isPlay){var currentActives=activeSounds.filter(function(sound){return sound.j===redBeatIndex;});// console.log('current actives: ',currentActives)\ncurrentActives.forEach(function(sound){for(var instrument in sound.activeInstruments){// console.log('instrument status: ', sound.activeInstruments[instrument])\nif(sound.activeInstruments[instrument]===true)play({id:instrument+sound.scale});}});}};var assignColor=function assignColor(i){if(!isPlay&&!isPause)return;return i===redBeatIndex?'red':'';};var checkInstrument=function checkInstrument(name){setInstruments(instruments.map(function(instrument){return instrument.name===name?_objectSpread(_objectSpread({},instrument),{},{checked:true}):_objectSpread(_objectSpread({},instrument),{},{checked:false});}));};var handleClickedSound=function handleClickedSound(i,j,instrument){setSounds(sounds.map(function(soundRow){return soundRow.map(function(sound){return sound.i===i&&sound.j===j?_objectSpread(_objectSpread({},sound),{},{activeInstruments:_objectSpread(_objectSpread({},sound.activeInstruments),{},_defineProperty({},instrument,!sound.activeInstruments[instrument]))}):sound;});}));};var handleTempo=function handleTempo(ev){var value=ev.target.value;setTempo(value);setDelay(60/value*1000);};var handleVolume=function handleVolume(ev){if(isPlay)setVolume(ev.target.value);};var assignSoundClass=function assignSoundClass(i,j,instrument){var currSoundInstrument=sounds[i][j].activeInstruments[instrument];return currSoundInstrument===true?'active':'';};var toggleMute=function toggleMute(){console.log('let mute!');var volumeSliderValue=document.getElementById('volume-slider').value;if(volumeSliderValue!==0){volumeSliderValue=0;document.querySelector('.mute').classList.remove('hidden');setRender(render+1);}else{volumeSliderValue=0.75;document.querySelector('.mute').classList.add('hidden');setRender(render+1);}};useEffect(function(){// console.log('red beat index updated: ', redBeatIndex)\n// console.log('sounds @ useeffect: ', sounds)\nvar actives=[];sounds.forEach(function(soundRow){return soundRow.forEach(function(sound){for(var instrument in sound.activeInstruments){if(sound.activeInstruments[instrument])actives.push(sound);}});});setActiveSounds(actives);fetch('/api').then(function(res){if(res.ok){return res.json();}}).then(function(jsonResponse){setInitialState(jsonResponse);}).catch(function(err){return console.error(err);});console.log('initial state: ',initialState);console.log('active sounds @ useeffect: ',activeSounds);playSounds();},[redBeatIndex,instruments,isPlay,isShowLoad,isShowSave]);var clearInstrument=function clearInstrument(){var curreentInsrtumentName=instruments.filter(function(instrument){return instrument.checked;})[0].name;setSounds(sounds.map(function(soundRow){return soundRow.map(function(sound){return sound.activeInstruments[curreentInsrtumentName]?_objectSpread(_objectSpread({},sound),{},{activeInstruments:_objectSpread(_objectSpread({},sound.activeInstruments),{},_defineProperty({},curreentInsrtumentName,false))}):sound;});}));};//////////////\nvar increment=useRef(null);var startPlaying=function startPlaying(){if(isPlay)return;setIsPlay(true);setIsPause(false);increment.current=setInterval(function(){setRedBeatIndex(function(redBeatIndex){return redBeatIndex===15?0:redBeatIndex+1;});},delay);};var pausePlaying=function pausePlaying(){if(!isPlay)return;clearInterval(increment.current);setIsPlay(false);setIsPause(true);};var stopPlaying=function stopPlaying(){clearInterval(increment.current);setIsPlay(false);setIsPause(false);setRedBeatIndex(0);};var resetPlaying=function resetPlaying(){clearInterval(increment.current);setIsPlay(false);setIsPause(false);setRedBeatIndex(0);setDelay(1000);setTempo(60);document.getElementById('tempo-slider').value=60;document.getElementById('volume-slider').value=0.75;setVolume(0.75);setSounds(getSoundPoints());setActiveSounds([]);};///////////////\nvar playUpdateTempo=function playUpdateTempo(){if(!isPlay)return;clearInterval(increment.current);increment.current=setInterval(function(){setRedBeatIndex(function(redBeatIndex){return redBeatIndex===15?0:redBeatIndex+1;});},delay);};var toggleSaveModal=function toggleSaveModal(){setIsShowSave(!isShowSave);if(isShowSave)setIsShowLoad(false);};var toggleLoadModal=function toggleLoadModal(){setIsShowLoad(!isShowLoad);if(isShowLoad)setIsShowSave(false);};var loadSounds=function loadSounds(snds,tmpo){var parsedSounds=JSON.parse(snds);setSounds(parsedSounds);setTempo(tmpo);setDelay(60/tmpo*1000);toggleLoadModal();};return/*#__PURE__*/React.createElement(Provider,{value:{beatCpts:beatCpts,delay:delay,initialState:initialState,instruments:instruments,isShowLoad:isShowLoad,isShowSave:isShowSave,tempo:tempo,sounds:sounds,redBeatIndex:redBeatIndex,volume:volume,actions:{assignColor:assignColor,checkInstrument:checkInstrument,clearInstrument:clearInstrument,handleClickedSound:handleClickedSound,handleTempo:handleTempo,handleVolume:handleVolume,loadSounds:loadSounds,startPlaying:startPlaying,stopPlaying:stopPlaying,toggleMute:toggleMute,toggleLoadModal:toggleLoadModal,toggleSaveModal:toggleSaveModal,pausePlaying:pausePlaying,playUpdateTempo:playUpdateTempo,resetPlaying:resetPlaying,assignSoundClass:assignSoundClass}}},/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(Main,null)));}export default App;","map":{"version":3,"sources":["C:/Users/איתי/Downloads/go local/react/beatmaker/client/src/App.js"],"names":["React","useState","useEffect","useRef","Provider","useSound","notes","Main","App","BEATS","SCALES","getBeatCpts","beatCpts","i","push","getSoundPoints","sounds","length","j","scale","activeInstruments","getSprites","count","sprites","instruments","forEach","instrument","name","setSounds","activeSounds","setActiveSounds","redBeatIndex","setRedBeatIndex","render","setRender","initialState","setInitialState","checked","setInstruments","isShowSave","setIsShowSave","isShowLoad","setIsShowLoad","isPlay","setIsPlay","isPause","setIsPause","delay","setDelay","tempo","setTempo","volume","setVolume","sprite","interrupt","play","playSounds","currentActives","filter","sound","id","assignColor","checkInstrument","map","handleClickedSound","soundRow","handleTempo","ev","value","target","handleVolume","assignSoundClass","currSoundInstrument","toggleMute","console","log","volumeSliderValue","document","getElementById","querySelector","classList","remove","add","actives","fetch","then","res","ok","json","jsonResponse","catch","err","error","clearInstrument","curreentInsrtumentName","increment","startPlaying","current","setInterval","pausePlaying","clearInterval","stopPlaying","resetPlaying","playUpdateTempo","toggleSaveModal","toggleLoadModal","loadSounds","snds","tmpo","parsedSounds","JSON","parse","actions"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { Provider } from './components/Context'\nimport useSound from 'use-sound'\nimport notes from './../src/sounds/all-instruments.mp3'\nimport './App.css';\nimport Main from './components/Main/Main.js'\n\n\nfunction App() {\n\n  const BEATS = 16\n  const SCALES = ['C2', 'D2', 'E2', 'G2', 'C3', 'D3', 'E3', 'G3', 'C4', 'D4', 'E4']\n\n\n  const getBeatCpts = () => {\n    let beatCpts = []\n    for (let i = 0; i < BEATS; i++) {\n      beatCpts.push(i)\n    }\n    return beatCpts\n  }\n\n  const beatCpts = getBeatCpts()\n\n  const getSoundPoints = () => {\n    let sounds = []\n    for (let i = 0; i < SCALES.length; i++) {\n      sounds.push([])\n      for (let j = 0; j < BEATS; j++) {\n        sounds[i].push({\n          i: i, j: j, scale: SCALES[i],\n          activeInstruments:  {}\n        })\n      }\n    }\n    return sounds\n  }\n\n\n\n  const  getSprites = () => {\n    let count = -1000\n    let sprites = {}\n    instruments.forEach( instrument => {\n      ( SCALES.forEach(scale => {\n        sprites[instrument.name + scale] =  [count += 1000, 1000]  \n      }))\n    })\n    return sprites\n  }\n\n  const [sounds, setSounds] = useState(getSoundPoints())\n  const [activeSounds, setActiveSounds] = useState([])\n  const [redBeatIndex, setRedBeatIndex] = useState(0)\n  const [render, setRender] = useState(0)\n  const [initialState,setInitialState] = useState([])\n  const [instruments, setInstruments] = useState([\n    { name: 'saxophone', checked: true },\n    { name: 'cello', checked: false },\n    { name: 'oboe', checked: false },\n    { name: 'vocal', checked: false },\n    { name: 'guitar', checked: false },\n    { name: 'kora', checked: false },\n    { name: 'vibraphone', checked: false },\n    { name: 'drums', checked: false },\n    { name: 'violin', checked: false}\n  ])\n  const [isShowSave, setIsShowSave] = useState(false)\n  const [isShowLoad, setIsShowLoad] = useState(false)\n  const [isPlay, setIsPlay] = useState(false)\n  const [isPause, setIsPause] = useState(false)\n  const [delay, setDelay] = useState(1000)\n  const [tempo, setTempo] = useState(60)\n  const [volume, setVolume] = useState(0.75)\n  const [play] = useSound(notes, {\n    volume: volume,\n    sprite: getSprites(),\n    interrupt: false\n  })\n\n\n\n  const playSounds = () => {\n\n    if (isPlay) {\n\n      let currentActives = activeSounds.filter(sound => sound.j === redBeatIndex)\n      // console.log('current actives: ',currentActives)\n      currentActives.forEach(sound => {\n        for (let instrument in sound.activeInstruments) {\n          // console.log('instrument status: ', sound.activeInstruments[instrument])\n          if (sound.activeInstruments[instrument] === true) play({id: instrument + sound.scale})\n        }\n      })\n    }\n  }\n\n  const assignColor = i => {\n    if (!isPlay && !isPause) return\n    return i === redBeatIndex ? 'red' : ''\n  }\n\n  const checkInstrument = name => {\n    setInstruments(instruments.map(instrument => (instrument.name === name) ? { ...instrument, checked: true } : { ...instrument, checked: false }))\n  }\n\n  const handleClickedSound = (i, j, instrument) => {\n    setSounds(\n      sounds.map(soundRow =>\n        soundRow.map(sound => (sound.i === i && sound.j === j) ? { ...sound, activeInstruments: { ...sound.activeInstruments, [instrument]: !sound.activeInstruments[instrument] } } : sound\n        ))\n    )\n  }\n\n\n\n  const handleTempo = ev => {\n    let value = ev.target.value\n    setTempo(value)\n    setDelay(60 / value * 1000)\n  }\n\n\n  const handleVolume = ev =>  {if (isPlay) setVolume(ev.target.value)}\n\n  const assignSoundClass = (i, j, instrument) => {\n    let currSoundInstrument = sounds[i][j].activeInstruments[instrument]\n    return (currSoundInstrument === true) ? 'active' : ''\n  }\n\n  const toggleMute = () => {\n    console.log('let mute!')\n    let volumeSliderValue = document.getElementById('volume-slider').value\n    if (volumeSliderValue !== 0) {\n      volumeSliderValue = 0\n      document.querySelector('.mute').classList.remove('hidden')\n      setRender(render+1)\n    } else {\n      volumeSliderValue = 0.75\n      document.querySelector('.mute').classList.add('hidden')\n      setRender(render+1)\n    }\n  }\n\n\n  useEffect(() => {\n    // console.log('red beat index updated: ', redBeatIndex)\n    // console.log('sounds @ useeffect: ', sounds)\n    let actives = []\n    sounds.forEach(soundRow => soundRow.forEach(sound => {\n      for (let instrument in (sound.activeInstruments)){\n        if (sound.activeInstruments[instrument]) actives.push(sound)\n      }\n    }))\n    setActiveSounds(actives) \n    fetch('/api')\n    .then(res=> {\n      if(res.ok){\n        return res.json()\n      }\n    }).then(jsonResponse => {\n      setInitialState(jsonResponse)\n    })\n    .catch(err => console.error(err))\n    console.log('initial state: ',initialState)\n    console.log('active sounds @ useeffect: ', activeSounds)\n    playSounds()\n  }, [redBeatIndex, instruments, isPlay,isShowLoad,isShowSave])\n\n\n  const clearInstrument = () => {\n    let curreentInsrtumentName = instruments.filter(instrument => instrument.checked)[0].name\n    setSounds(sounds.map(soundRow => soundRow.map(\n      (sound => (sound.activeInstruments[curreentInsrtumentName]) ? { ...sound, activeInstruments: { ...sound.activeInstruments, [curreentInsrtumentName]: false } } : sound\n      )\n    )))\n  }\n\n  //////////////\n  const increment = useRef(null)\n  const startPlaying = () => {\n    if (isPlay) return\n\n    setIsPlay(true)\n    setIsPause(false)\n    increment.current = setInterval(() => {\n      setRedBeatIndex((redBeatIndex) => redBeatIndex === 15 ? 0 : redBeatIndex + 1)\n    }, delay)\n  }\n\n  const pausePlaying = () => {\n    if (!isPlay) return\n    clearInterval(increment.current);\n    setIsPlay(false)\n    setIsPause(true)\n  }\n\n  const stopPlaying = () => {\n    clearInterval(increment.current)\n    setIsPlay(false)\n    setIsPause(false)\n    setRedBeatIndex(0)\n  }\n\n  const resetPlaying = () => {\n    clearInterval(increment.current)\n    setIsPlay(false)\n    setIsPause(false)\n    setRedBeatIndex(0)\n    setDelay(1000)\n    setTempo(60)\n    document.getElementById('tempo-slider').value = 60\n    document.getElementById('volume-slider').value = 0.75\n    setVolume(0.75)\n    setSounds(getSoundPoints())\n    setActiveSounds([])\n  }\n\n  ///////////////\n\n  const playUpdateTempo = () => {\n    if (!isPlay) return\n    clearInterval(increment.current);\n    increment.current = setInterval(() => {\n      setRedBeatIndex((redBeatIndex) => redBeatIndex === 15 ? 0 : redBeatIndex + 1)\n    }, delay)\n  }\n\n \n\n  const toggleSaveModal = () => {\n    setIsShowSave(!isShowSave)\n    if (isShowSave) setIsShowLoad(false)\n  }\n\n\n\n  const toggleLoadModal = () => {\n    setIsShowLoad(!isShowLoad)\n    if (isShowLoad) setIsShowSave(false)\n  }\n\n  const loadSounds = (snds,tmpo) => {\n    let parsedSounds = JSON.parse(snds)\n    setSounds(parsedSounds)\n    setTempo(tmpo)\n    setDelay(60 / tmpo * 1000)\n    toggleLoadModal()\n  }\n\n  return (\n    <Provider value={\n      {\n        beatCpts: beatCpts,\n        delay: delay,\n        initialState: initialState,\n        instruments: instruments,\n        isShowLoad: isShowLoad,\n        isShowSave: isShowSave,\n        tempo: tempo,\n        sounds: sounds,\n        redBeatIndex: redBeatIndex,\n        volume: volume,\n        actions: {\n          assignColor: assignColor,\n          checkInstrument: checkInstrument,\n          clearInstrument : clearInstrument,\n          handleClickedSound: handleClickedSound,\n          handleTempo: handleTempo,\n          handleVolume: handleVolume,\n          loadSounds : loadSounds,\n          startPlaying: startPlaying,\n          stopPlaying: stopPlaying,\n          toggleMute: toggleMute,\n          toggleLoadModal: toggleLoadModal,\n          toggleSaveModal: toggleSaveModal,\n          pausePlaying: pausePlaying,\n          playUpdateTempo: playUpdateTempo,\n          resetPlaying: resetPlaying,\n          assignSoundClass: assignSoundClass\n        }\n      }\n    }>\n\n      <div className=\"App\">\n          <Main />\n      </div>\n    </Provider>\n  )\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}