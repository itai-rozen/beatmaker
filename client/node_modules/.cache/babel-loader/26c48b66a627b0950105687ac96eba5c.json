{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\u05D0\\u05D9\\u05EA\\u05D9\\\\Downloads\\\\go local\\\\react\\\\beatmaker\\\\client\\\\src\\\\App.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Provider } from './components/Context';\nimport useSound from 'use-sound';\nimport notes from './../src/sounds/all-instruments.mp3';\nimport './App.css';\nimport Main from './components/Main/Main.js';\n\nfunction App() {\n  // creating the scale & beat constants\n  const BEATS = 16;\n  const SCALES = ['C2', 'D2', 'E2', 'G2', 'C3', 'D3', 'E3', 'G3', 'C4', 'D4', 'E4']; // creating the BeatBar \n\n  const getBeatCpts = () => {\n    let beatCpts = [];\n\n    for (let i = 0; i < BEATS; i++) {\n      beatCpts.push(i);\n    }\n\n    return beatCpts;\n  };\n\n  const beatCpts = getBeatCpts(); // creating the SoundBoard\n\n  const getSoundPoints = () => {\n    let sounds = [];\n\n    for (let i = 0; i < SCALES.length; i++) {\n      sounds.push([]);\n\n      for (let j = 0; j < BEATS; j++) {\n        sounds[i].push({\n          i: i,\n          j: j,\n          scale: SCALES[i],\n          activeInstruments: {}\n        });\n      }\n    }\n\n    return sounds;\n  }; // assigning names and intervals for the sounds in the mp3 file\n\n\n  const getSprites = () => {\n    let count = -1000;\n    let sprites = {};\n    instruments.forEach(instrument => {\n      SCALES.forEach(scale => {\n        sprites[instrument.name + scale] = [count += 1000, 1000];\n      });\n    });\n    return sprites;\n  }; // initializing some varibales with HOOKS\n\n\n  const [sounds, setSounds] = useState(getSoundPoints());\n  const [activeSounds, setActiveSounds] = useState([]);\n  const [redBeatIndex, setRedBeatIndex] = useState(-1);\n  const [render, setRender] = useState(0);\n  const [initialState, setInitialState] = useState([]);\n  const [instruments, setInstruments] = useState([{\n    name: 'saxophone',\n    checked: true\n  }, {\n    name: 'cello',\n    checked: false\n  }, {\n    name: 'oboe',\n    checked: false\n  }, {\n    name: 'vocal',\n    checked: false\n  }, {\n    name: 'guitar',\n    checked: false\n  }, {\n    name: 'kora',\n    checked: false\n  }, {\n    name: 'vibraphone',\n    checked: false\n  }, {\n    name: 'drums',\n    checked: false\n  }, {\n    name: 'violin',\n    checked: false\n  }]);\n  const [isShowSave, setIsShowSave] = useState(false);\n  const [isShowLoad, setIsShowLoad] = useState(false);\n  const [isPlay, setIsPlay] = useState(false);\n  const [isPause, setIsPause] = useState(false);\n  const [delay, setDelay] = useState(1000);\n  const [tempo, setTempo] = useState(60);\n  const [volume, setVolume] = useState(0.75);\n  const [play] = useSound(notes, {\n    volume: volume,\n    sprite: getSprites(),\n    interrupt: false\n  }); // functions for the Instrument Bar\n\n  const checkInstrument = name => {\n    setInstruments(instruments.map(instrument => instrument.name === name ? { ...instrument,\n      checked: true\n    } : { ...instrument,\n      checked: false\n    }));\n  }; // functions for the Beat Bar\n\n\n  const assignColor = i => {\n    if (!isPlay && !isPause) return;\n    return i === redBeatIndex ? 'red' : '';\n  }; // functions for the Sound Board\n\n\n  const handleClickedSound = (i, j, instrument) => {\n    setSounds(sounds.map(soundRow => soundRow.map(sound => sound.i === i && sound.j === j ? { ...sound,\n      activeInstruments: { ...sound.activeInstruments,\n        [instrument]: !sound.activeInstruments[instrument]\n      }\n    } : sound)));\n  };\n\n  const assignSoundClass = (i, j, instrument) => {\n    let currSoundInstrument = sounds[i][j].activeInstruments[instrument];\n    return currSoundInstrument === true ? 'active' : '';\n  };\n\n  const handleTempo = ev => {\n    let value = ev.target.value;\n    setTempo(value);\n    setDelay(60 / value * 1000);\n  };\n\n  const handleVolume = ev => {\n    if (isPlay) setVolume(ev.target.value);\n  }; // const toggleMute = () => {\n  //   console.log('let mute!')\n  //   let volumeSliderValue = document.getElementById('volume-slider').value\n  //   if (volumeSliderValue !== 0) {\n  //     volumeSliderValue = 0\n  //     document.querySelector('.mute').classList.remove('hidden')\n  //     setRender(render+1)\n  //   } else {\n  //     volumeSliderValue = 0.75\n  //     document.querySelector('.mute').classList.add('hidden')\n  //     setRender(render+1)\n  //   }\n  // }\n\n\n  const playSounds = () => {\n    if (isPlay) {\n      let currentActives = activeSounds.filter(sound => sound.j === redBeatIndex); // console.log('current actives: ',currentActives)\n\n      currentActives.forEach(sound => {\n        for (let instrument in sound.activeInstruments) {\n          // console.log('instrument status: ', sound.activeInstruments[instrument])\n          if (sound.activeInstruments[instrument] === true) play({\n            id: instrument + sound.scale\n          });\n        }\n      });\n    }\n  };\n\n  useEffect(() => {\n    // console.log('red beat index updated: ', redBeatIndex)\n    // console.log('sounds @ useeffect: ', sounds)\n    let actives = [];\n    sounds.forEach(soundRow => soundRow.forEach(sound => {\n      for (let instrument in sound.activeInstruments) {\n        if (sound.activeInstruments[instrument]) actives.push(sound);\n      }\n    }));\n    setActiveSounds(actives);\n    fetch('/api').then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n    }).then(jsonResponse => {\n      setInitialState(jsonResponse);\n    }).catch(err => console.error(err));\n    console.log('initial state: ', initialState);\n    console.log('active sounds @ useeffect: ', activeSounds);\n    playSounds();\n  }, [redBeatIndex, isPlay, isShowLoad, isShowSave]);\n\n  const clearInstrument = () => {\n    let currentInsrtumentName = instruments.filter(instrument => instrument.checked)[0].name;\n    setSounds(sounds.map(soundRow => soundRow.map(sound => sound.activeInstruments[currentInsrtumentName] ? { ...sound,\n      activeInstruments: { ...sound.activeInstruments,\n        [currentInsrtumentName]: false\n      }\n    } : sound)));\n  }; // functions for the \n\n\n  const increment = useRef(null);\n\n  const startPlaying = () => {\n    if (isPlay) return;\n    setIsPlay(true);\n    setIsPause(false);\n    increment.current = setInterval(() => {\n      setRedBeatIndex(redBeatIndex => redBeatIndex === 15 ? 0 : redBeatIndex + 1);\n    }, delay);\n  };\n\n  const pausePlaying = () => {\n    if (!isPlay) return;\n    clearInterval(increment.current);\n    setIsPlay(false);\n    setIsPause(true);\n  };\n\n  const stopPlaying = () => {\n    clearInterval(increment.current);\n    setIsPlay(false);\n    setIsPause(false);\n    setRedBeatIndex(0);\n  };\n\n  const resetPlaying = () => {\n    clearInterval(increment.current);\n    setIsPlay(false);\n    setIsPause(false);\n    setRedBeatIndex(-1);\n    setDelay(1000);\n    setTempo(60);\n    document.getElementById('tempo-slider').value = 60;\n    document.getElementById('volume-slider').value = 0.75;\n    setVolume(0.75);\n    setSounds(getSoundPoints());\n    setActiveSounds([]);\n  }; ///////////////\n\n\n  const playUpdateTempo = () => {\n    if (!isPlay) return;\n    clearInterval(increment.current);\n    increment.current = setInterval(() => {\n      setRedBeatIndex(redBeatIndex => redBeatIndex === 15 ? 0 : redBeatIndex + 1);\n    }, delay);\n  };\n\n  const toggleSaveModal = () => {\n    setIsShowSave(!isShowSave);\n    if (isShowSave) setIsShowLoad(false);\n  };\n\n  const toggleLoadModal = () => {\n    setIsShowLoad(!isShowLoad);\n    if (isShowLoad) setIsShowSave(false);\n  };\n\n  const loadSounds = (snds, tmpo) => {\n    let parsedSounds = JSON.parse(snds);\n    setSounds(parsedSounds);\n    setTempo(tmpo);\n    setDelay(60 / tmpo * 1000);\n    toggleLoadModal();\n  };\n\n  return /*#__PURE__*/React.createElement(Provider, {\n    value: {\n      beatCpts: beatCpts,\n      delay: delay,\n      initialState: initialState,\n      instruments: instruments,\n      isShowLoad: isShowLoad,\n      isShowSave: isShowSave,\n      tempo: tempo,\n      sounds: sounds,\n      redBeatIndex: redBeatIndex,\n      volume: volume,\n      actions: {\n        assignColor: assignColor,\n        checkInstrument: checkInstrument,\n        clearInstrument: clearInstrument,\n        handleClickedSound: handleClickedSound,\n        handleTempo: handleTempo,\n        handleVolume: handleVolume,\n        loadSounds: loadSounds,\n        startPlaying: startPlaying,\n        stopPlaying: stopPlaying,\n        toggleMute: toggleMute,\n        toggleLoadModal: toggleLoadModal,\n        toggleSaveModal: toggleSaveModal,\n        pausePlaying: pausePlaying,\n        playUpdateTempo: playUpdateTempo,\n        resetPlaying: resetPlaying,\n        assignSoundClass: assignSoundClass\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Main, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 11\n    }\n  })));\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Users/איתי/Downloads/go local/react/beatmaker/client/src/App.js"],"names":["React","useState","useEffect","useRef","Provider","useSound","notes","Main","App","BEATS","SCALES","getBeatCpts","beatCpts","i","push","getSoundPoints","sounds","length","j","scale","activeInstruments","getSprites","count","sprites","instruments","forEach","instrument","name","setSounds","activeSounds","setActiveSounds","redBeatIndex","setRedBeatIndex","render","setRender","initialState","setInitialState","setInstruments","checked","isShowSave","setIsShowSave","isShowLoad","setIsShowLoad","isPlay","setIsPlay","isPause","setIsPause","delay","setDelay","tempo","setTempo","volume","setVolume","play","sprite","interrupt","checkInstrument","map","assignColor","handleClickedSound","soundRow","sound","assignSoundClass","currSoundInstrument","handleTempo","ev","value","target","handleVolume","playSounds","currentActives","filter","id","actives","fetch","then","res","ok","json","jsonResponse","catch","err","console","error","log","clearInstrument","currentInsrtumentName","increment","startPlaying","current","setInterval","pausePlaying","clearInterval","stopPlaying","resetPlaying","document","getElementById","playUpdateTempo","toggleSaveModal","toggleLoadModal","loadSounds","snds","tmpo","parsedSounds","JSON","parse","actions","toggleMute"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { Provider } from './components/Context'\nimport useSound from 'use-sound'\nimport notes from './../src/sounds/all-instruments.mp3'\nimport './App.css';\nimport Main from './components/Main/Main.js'\n\n\nfunction App() {\n\n  // creating the scale & beat constants\n  const BEATS = 16\n  const SCALES = ['C2', 'D2', 'E2', 'G2', 'C3', 'D3', 'E3', 'G3', 'C4', 'D4', 'E4']\n\n  // creating the BeatBar \n  const getBeatCpts = () => {\n    let beatCpts = []\n    for (let i = 0; i < BEATS; i++) {\n      beatCpts.push(i)\n    }\n    return beatCpts\n  }\n\n  const beatCpts = getBeatCpts()\n\n   // creating the SoundBoard\n\n  const getSoundPoints = () => {\n    let sounds = []\n    for (let i = 0; i < SCALES.length; i++) {\n      sounds.push([])\n      for (let j = 0; j < BEATS; j++) {\n        sounds[i].push({\n          i: i, j: j, scale: SCALES[i],\n          activeInstruments:  {}\n        })\n      }\n    }\n    return sounds\n  }\n\n\n  // assigning names and intervals for the sounds in the mp3 file\n\n  const  getSprites = () => {\n    let count = -1000\n    let sprites = {}\n    instruments.forEach( instrument => {\n      ( SCALES.forEach(scale => {\n        sprites[instrument.name + scale] =  [count += 1000, 1000]  \n      }))\n    })\n    return sprites\n  }\n\n  // initializing some varibales with HOOKS\n\n  const [sounds, setSounds] = useState(getSoundPoints())\n  const [activeSounds, setActiveSounds] = useState([])\n  const [redBeatIndex, setRedBeatIndex] = useState(-1)\n  const [render, setRender] = useState(0)\n  const [initialState,setInitialState] = useState([])\n  const [instruments, setInstruments] = useState([\n    { name: 'saxophone', checked: true },\n    { name: 'cello', checked: false },\n    { name: 'oboe', checked: false },\n    { name: 'vocal', checked: false },\n    { name: 'guitar', checked: false },\n    { name: 'kora', checked: false },\n    { name: 'vibraphone', checked: false },\n    { name: 'drums', checked: false },\n    { name: 'violin', checked: false}\n  ])\n  const [isShowSave, setIsShowSave] = useState(false)\n  const [isShowLoad, setIsShowLoad] = useState(false)\n  const [isPlay, setIsPlay] = useState(false)\n  const [isPause, setIsPause] = useState(false)\n  const [delay, setDelay] = useState(1000)\n  const [tempo, setTempo] = useState(60)\n  const [volume, setVolume] = useState(0.75)\n  const [play] = useSound(notes, {\n    volume: volume,\n    sprite: getSprites(),\n    interrupt: false\n  })\n\n  // functions for the Instrument Bar\n\n  const checkInstrument = name => {\n    setInstruments(instruments.map(instrument => (instrument.name === name) ? { ...instrument, checked: true } : { ...instrument, checked: false }))\n  }\n\n\n  // functions for the Beat Bar\n  const assignColor = i => {\n    if (!isPlay && !isPause) return\n    return i === redBeatIndex ? 'red' : ''\n  }\n\n  // functions for the Sound Board\n\n  const handleClickedSound = (i, j, instrument) => {\n    setSounds(\n      sounds.map(soundRow =>\n        soundRow.map(sound => (sound.i === i && sound.j === j) ? { ...sound, activeInstruments: { ...sound.activeInstruments, [instrument]: !sound.activeInstruments[instrument] } } : sound\n        ))\n    )\n  }\n\n  const assignSoundClass = (i, j, instrument) => {\n    let currSoundInstrument = sounds[i][j].activeInstruments[instrument]\n    return (currSoundInstrument === true) ? 'active' : ''\n  }\n\n\n  \n  const handleTempo = ev => {\n    let value = ev.target.value\n    setTempo(value)\n    setDelay(60 / value * 1000)\n  }\n\n\n  const handleVolume = ev =>  {if (isPlay) setVolume(ev.target.value)}\n\n\n\n  // const toggleMute = () => {\n  //   console.log('let mute!')\n  //   let volumeSliderValue = document.getElementById('volume-slider').value\n  //   if (volumeSliderValue !== 0) {\n  //     volumeSliderValue = 0\n  //     document.querySelector('.mute').classList.remove('hidden')\n  //     setRender(render+1)\n  //   } else {\n  //     volumeSliderValue = 0.75\n  //     document.querySelector('.mute').classList.add('hidden')\n  //     setRender(render+1)\n  //   }\n  // }\n\n\n\n  const playSounds = () => {\n\n    if (isPlay) {\n\n      let currentActives = activeSounds.filter(sound => sound.j === redBeatIndex)\n      // console.log('current actives: ',currentActives)\n      currentActives.forEach(sound => {\n        for (let instrument in sound.activeInstruments) {\n          // console.log('instrument status: ', sound.activeInstruments[instrument])\n          if (sound.activeInstruments[instrument] === true) play({id: instrument + sound.scale})\n        }\n      })\n    }\n  }\n\n  useEffect(() => {\n    // console.log('red beat index updated: ', redBeatIndex)\n    // console.log('sounds @ useeffect: ', sounds)\n    let actives = []\n    sounds.forEach(soundRow => soundRow.forEach(sound => {\n      for (let instrument in (sound.activeInstruments)){\n        if (sound.activeInstruments[instrument]) actives.push(sound)\n      }\n    }))\n    setActiveSounds(actives) \n    fetch('/api')\n    .then(res=> {\n      if(res.ok){\n        return res.json()\n      }\n    }).then(jsonResponse => {\n      setInitialState(jsonResponse)\n    })\n    .catch(err => console.error(err))\n    console.log('initial state: ',initialState)\n    console.log('active sounds @ useeffect: ', activeSounds)\n    playSounds()\n  }, [redBeatIndex, isPlay,isShowLoad,isShowSave])\n\n\n  const clearInstrument = () => {\n    let currentInsrtumentName = instruments.filter(instrument => instrument.checked)[0].name\n    setSounds(sounds.map(soundRow => soundRow.map(\n      (sound => (sound.activeInstruments[currentInsrtumentName]) ? { ...sound, activeInstruments: { ...sound.activeInstruments, [currentInsrtumentName]: false } } : sound\n      )\n    )))\n  }\n\n  // functions for the \n  const increment = useRef(null)\n  const startPlaying = () => {\n    if (isPlay) return\n\n    setIsPlay(true)\n    setIsPause(false)\n    increment.current = setInterval(() => {\n      setRedBeatIndex((redBeatIndex) => redBeatIndex === 15 ? 0 : redBeatIndex + 1)\n    }, delay)\n  }\n\n  const pausePlaying = () => {\n    if (!isPlay) return\n    clearInterval(increment.current);\n    setIsPlay(false)\n    setIsPause(true)\n  }\n\n  const stopPlaying = () => {\n    clearInterval(increment.current)\n    setIsPlay(false)\n    setIsPause(false)\n    setRedBeatIndex(0)\n  }\n\n  const resetPlaying = () => {\n    clearInterval(increment.current)\n    setIsPlay(false)\n    setIsPause(false)\n    setRedBeatIndex(-1)\n    setDelay(1000)\n    setTempo(60)\n    document.getElementById('tempo-slider').value = 60\n    document.getElementById('volume-slider').value = 0.75\n    setVolume(0.75)\n    setSounds(getSoundPoints())\n    setActiveSounds([])\n  }\n\n  ///////////////\n\n  const playUpdateTempo = () => {\n    if (!isPlay) return\n    clearInterval(increment.current);\n    increment.current = setInterval(() => {\n      setRedBeatIndex((redBeatIndex) => redBeatIndex === 15 ? 0 : redBeatIndex + 1)\n    }, delay)\n  }\n\n \n\n  const toggleSaveModal = () => {\n    setIsShowSave(!isShowSave)\n    if (isShowSave) setIsShowLoad(false)\n  }\n\n\n\n  const toggleLoadModal = () => {\n    setIsShowLoad(!isShowLoad)\n    if (isShowLoad) setIsShowSave(false)\n  }\n\n  const loadSounds = (snds,tmpo) => {\n    let parsedSounds = JSON.parse(snds)\n    setSounds(parsedSounds)\n    setTempo(tmpo)\n    setDelay(60 / tmpo * 1000)\n    toggleLoadModal()\n  }\n\n  return (\n    <Provider value={\n      {\n        beatCpts: beatCpts,\n        delay: delay,\n        initialState: initialState,\n        instruments: instruments,\n        isShowLoad: isShowLoad,\n        isShowSave: isShowSave,\n        tempo: tempo,\n        sounds: sounds,\n        redBeatIndex: redBeatIndex,\n        volume: volume,\n        actions: {\n          assignColor: assignColor,\n          checkInstrument: checkInstrument,\n          clearInstrument : clearInstrument,\n          handleClickedSound: handleClickedSound,\n          handleTempo: handleTempo,\n          handleVolume: handleVolume,\n          loadSounds : loadSounds,\n          startPlaying: startPlaying,\n          stopPlaying: stopPlaying,\n          toggleMute: toggleMute,\n          toggleLoadModal: toggleLoadModal,\n          toggleSaveModal: toggleSaveModal,\n          pausePlaying: pausePlaying,\n          playUpdateTempo: playUpdateTempo,\n          resetPlaying: resetPlaying,\n          assignSoundClass: assignSoundClass\n        }\n      }\n    }>\n\n      <div className=\"App\">\n          <Main />\n      </div>\n    </Provider>\n  )\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}